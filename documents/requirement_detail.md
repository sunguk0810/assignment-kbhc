# 프로젝트 요구사항 명세서

## 1. 요구사항 목록

### 인프라 및 기술 스택
- [x] **환경 구성**: Docker Compose를 기반으로 한 로컬 개발 및 테스트 환경 구축
- [x] **백엔드 기술 스택**: Java 17, Spring Boot 4.0.1, Spring Data JPA 기반의 서비스 구성
- [x] **데이터 저장소**: 
    - **MySQL 8.x**: 건강 데이터 및 회원 정보 저장
    - **Redis**: JWT Refresh Token 관리 및 데이터 캐싱
- [x] **테스트 데이터**: 사용자가 즉시 테스트 가능하도록 샘플 데이터 및 가이드 제공

### 보안 및 회원 관리
- [x] **인증/인가**: JWT(JSON Web Token) 기반의 보안 아키텍처 구현
    - Access Token 및 Refresh Token을 이용한 이중 인증 구조
    - 개인의 신체 정보는 본인만 접근 가능하도록 데이터 권한 제어
- [x] **회원가입**: 사용자 기본 정보 및 신체 프로필(키, 몸무게 등) 수집
    - 비밀번호 암호화(BCrypt) 및 유효성 검증 적용
- [x] **로그인/로그아웃**: 이메일 기반 로그인 및 로그아웃(토큰 무효화) 기능
- [x] **토큰 재발급**: Refresh Token을 활용한 세션 연장 기능

### 건강 측정 데이터 관리
- [x] **데이터 수집 및 적재**: 삼성헬스, 애플건강 등 외부 소스 데이터 연동
    - **Raw Data 저장**: 데이터 무결성을 위해 수신된 원본 JSON을 그대로 로그 저장
    - **가공 데이터 저장**: 분석 및 조회를 위해 도메인 모델로 변환하여 저장
- [x] **다양한 측정 타입 지원**: 걸음 수, 혈압, 심박수, 혈당 등 가변적인 항목 지원 (JSON 타입 활용)
- [x] **데이터 요약 및 통계**: 
    - 일별/월별 요약 데이터 제공
    - 측정 타입별 맞춤형 요약 필드(평균, 합계 등) 제공

### API 공통 표준
- [x] **표준 응답 포맷**: 모든 API는 성공/실패 시 일관된 JSON 구조로 응답
- [x] **예외 처리**: 사용자에게 Stack Trace 노출을 방지하고 정형화된 에러 메시지 반환
- [x] **검증 오류**: 유효성 검사 실패 시 필드별 상세 사유를 응답에 포함

---

## 2. 상세 요구사항 (시나리오 및 스펙)

### 인프라 및 환경

#### [INFRA-1] 개발 및 테스트 환경 구성
- **시나리오**: 개발자는 빠르고 일관된 환경에서 서비스를 실행하고 테스트할 수 있어야 한다.
- **스펙**:
  - `Docker Compose`를 사용하여 MySQL, Redis 등 의존성 서비스를 한 번에 실행합니다.
  - `data/sample-data` 디렉토리에 테스트 가능한 샘플 JSON 파일(혈압, 걸음수 등)을 제공하여 사용자가 쉽게 API를 시험해 볼 수 있도록 합니다.

### API 및 아키텍처 공통

#### [CORE-1] RESTful API 표준 응답
- **시나리오**: 클라이언트는 항상 예측 가능한 형태의 응답을 받아야 하며, 성공과 실패를 일관되게 처리할 수 있어야 한다.
- **스펙**:
  - 모든 응답은 아래 `ApiResponse` 래퍼(wrapper) 포맷을 준수합니다.
  ```json
  {
    "status": "success",
    "message": "요청이 성공했습니다.",
    "data": { ... },
    "createdAt": "2025-01-01T12:00:00"
  }
  ```
  - **오류 처리**: 서버 내부 오류(500) 시 Stack Trace를 노출하지 않고, 사용자 친화적인 메시지를 반환합니다.
  - **유효성 검증**: 입력값 오류(400) 시 어떤 필드가 왜 틀렸는지 상세 내역을 `error`, `code` 필드에 포함합니다.

#### [CORE-2] 데이터 보안 및 권한 제어
- **시나리오**: 사용자는 자신의 정보를 안전하게 보호받아야 하며, 타인이 내 데이터를 볼 수 없어야 한다.
- **스펙**:
  - 모든 API 요청은 `JWT Access Token` 기반으로 인증됩니다.
  - 도메인 설계 시 사용자 식별자(`recordKey` 등)를 기준으로 데이터의 소유권을 검증하여, 권한 없는 데이터 접근을 차단합니다.

### 회원 서비스 (User Service)

#### [USER-1] 회원가입
- **시나리오**: 신규 사용자는 이메일과 신체 프로필을 입력하여 서비스에 가입할 수 있다.
- **스펙**:
  - **입력 정보**: 이메일, 이름, 비밀번호, 신체 프로필(생년월일, 성별, 키, 몸무게 등)
  - **보안**: 비밀번호는 `BCrypt` 알고리즘으로 단방향 암호화하여 저장합니다.
  - **검증**: 이메일 형식, 비밀번호 복잡도(영문/숫자/특수문자 조합 8자 이상)를 검사합니다.

#### [USER-2] 로그인 및 인증
- **시나리오**: 사용자는 이메일과 비밀번호로 로그인하여 보안 토큰을 발급받을 수 있다.
- **스펙**:
  - 인증 성공 시 `Access Token`(짧은 수명)과 `Refresh Token`(긴 수명)을 함께 발급합니다.
  - `Authorization: Bearer <Token>` 헤더 방식을 표준으로 사용합니다.

#### [USER-3] 토큰 재발급
- **시나리오**: 사용자는 로그인을 반복하지 않아도, 앱이 자동으로 만료된 인증을 갱신하여 끊김 없는 서비스를 경험한다.
- **스펙**:
  - `Refresh Token`을 Redis 등 저장소에서 검증하여 유효한 경우 새로운 `Access Token`을 발급합니다.

#### [USER-4] 로그아웃
- **시나리오**: 사용자는 공용 기기 등에서 안전하게 자신의 계정 연결을 끊을 수 있다.
- **스펙**:
  - 로그아웃 요청 시 서버에 저장된 해당 사용자의 `Refresh Token`을 즉시 삭제/무효화하여 추가적인 토큰 발급을 차단합니다.

### 건강 측정 서비스

#### [HEALTH-1] 건강 데이터 수집 및 저장
- **시나리오**: 사용자는 웨어러블 기기(삼성헬스, 애플건강 등)에서 측정된 다양한 건강 데이터를 서비스에 저장할 수 있다.
- **스펙**:
  - **비동기 처리**: 대량의 건강 데이터 유입에 대비하여 데이터 저장은 이벤트 기반(Producer-Consumer)으로 처리될 수 있도록 설계합니다.
  - **Raw Data 보존**: 수신된 JSON 원본을 별도의 로그 테이블에 그대로 저장하여 데이터 무결성을 보장하고 추후 분석에 활용합니다.
  - **다형성 지원**: `STEPS`, `BLOOD_PRESSURE` 등 측정 타입에 따라 서로 다른 데이터 구조(JSON)를 유연하게 저장합니다.

#### [HEALTH-2] 건강 통계 조회
- **시나리오**: 사용자는 자신의 일별, 월별 건강 활동 요약을 확인하여 생활 습관을 모니터링할 수 있다.
- **스펙**:
  - **조회 조건**: 날짜 범위(`startDate` ~ `endDate`)와 측정 타입(`type`)을 지정하여 조회합니다.
  - **동적 요약**: 
    - `걸음 수(STEPS)`: 총 걸음, 소모 칼로리, 이동 거리 합계
    - `혈압/심박수`: 기간 내 평균 수치
    - `혈당/산소포화도`: 기간 내 평균 및 최대/최소 수치 등 타입별로 의미 있는 요약 정보를 제공합니다.
