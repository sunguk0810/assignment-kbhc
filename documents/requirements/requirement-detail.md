# 상세 요구사항

## 시스템 장비 구성 요구사항
- 요구사항 고유번호 : `ECR-01-001`
- 요구사항 명칭 : 개발환경 구성
- 요구사항 상세설명
  - 정의 : 고객건강활동 정보 수집 서비스 개발과 운영시 필요한 전산환경 구축 공통사항
  - 세부내용
    - 서비스 구축을 위한 개발 환경 및 테스트 환경 구성
      - 기본적인 인프라 환경은 **Docker 베이스로 구성**한다.
      - 시스템 테스트시 **사용자가 테스트 해볼 수 있는 환경 및 데이터를 제시**한다 (예시: 회원 정보, 건강데이터 등)

## 기능 요구사항
- 요구사항 고유번호 : `SFR-01-001`
- 요구사항 명칭 : [공통] 서비스 공통 요구사항
- 요구사항 상세설명
  - 정의 : 고객건강활동 정보 수집 서비스 사용 기술등을 정의한다.
  - 세부내용
    - 다음 아래와 같은 기술을 이용하여 서비스를 구성한다.
      - Java 17
      - Spring Boot (Java 사용)
        - Spring Data JPA
      - MySQL 8.X
      - Redis or Kafka
    - 기타 그 이외의 필요로 하는 라이브러리를 추가하여 서비스를 구성한다. (예: JJWT, ...)
- 산출정보 : 프로젝트 구조도, 발생한 이슈 및 해결 방법, 테이블/컬럼정의서, ERD
---
- 요구사항 고유번호 : `SFR-01-002`
- 요구사항 명칭 : [공통] API 공통 요구사항
- 요구사항 상세설명
  - 정의 : 서비스 전반의 API 요청, 응답등을 정의한다.
  - 세부내용
    - API의 경우 상황에 따라 **인증 토큰을 Request Header에 포함**해야 한다. 포함하는 방법은 다음과 같다.
      - 인증 토큰은 `Authorization : Bearer JWT Token` 형식을 따른다.
    - 요구사항에 특정한 명시가 없으면 요청은 JSON 형식을 따른다.
    - 응답 데이터는 아래의 형식을 따른다. (예: Access Token 요청)
  ```json
  {
    "status": "success", // ['success', 'failure']
    "message": "정상적으로 수행하였습니다.",
    "data": {
      "access_token": "Qcg6yI1a5qCxX.....",
      "token_type": "Bearer",
      "expires_in": 3600,
      "refresh_token": "IwOGYzYTlmM2Yx..."
    },
    "createdAt": "2025-12-26T03:00:00"
  }
  ```
  - API 오류 발생시 아래의 형식을 따르며, **사용자에게 Stack Trace 원본을 data 속성에 넣어 보내지 않는다**.
  ```json
    {
      "status": "error",
      "message": "회원가입 중 오류가 발생하였습니다.",
      "data": null,
      "createdAt": "2025-12-26T03:00:00"
    } 
  ```

  - 검증 오류시 아래의 형식을 따른다.
  ```json
  {
    "status": "error",
    "message": "값 검증에 실패하였습니다.",
    "error": {
      "email": ["email 필드의 값이 필요합니다."],
      "password": ["password 필드의 값이 유효하지 않습니다."]
    },
    "data": null,
    "createdAt": "2025-12-06T"
  }
  ```
  - [공통] **요청 마다 UUID 값인 Trace-Id를 발생시키며, Response Header에 Trace-Id를 넣어 보내준다**.
    - `X-Trace-Id: {UUID}`
  - [공통] **요청 종료 시점마다 로그를 남겨야 하며, 로그는 다음과 같은 형식으로 남긴다**. (단, static resources 등은 제외한다)
    - [200 (Http Status)][Trace-Id] POST /api/v1/auth/register elapsed 200ms.
---
- 요구사항 고유번호 : `SFR-01-003`
- 요구사항 명칭 : [공통] 권한 및 회원 공통 요구사항
- 요구사항 상세설명
  - 정의 : 서비스의 권한 및 회원의 공통적인 요구사항을 정의한다.
  - 세부내용
    - [보안] 권한 및 회원 정보 관리
      - 고객은 각각 **정해진 범위내에서 데이터 조회 및 추가, 삭제, 수정을 진행**할 수 있다.
        - 예시)
          - 고객의 경우 개인의 신체 계측정보는 확인할 수 있지만, 타인의 신체계측 정보의 조회 및 추가, 삭제, 수정을 할 수 없다.
      - 따라서 고객은 각각 접근할 수 있는 기능의 제약을 위해 **권한정보를 설정할 수 있도록 도메인을 설계**해야하며,
        **회원의 정보 및 권한 정보를 JWT (JSON Web Token)으로 관리**할 수 있도록 구성한다.

---
- 요구사항 고유번호 : `SFR-02-001`
- 요구사항 명칭 : [회원] 회원가입
- 요구사항 상세설명
  - 정의 : 서비스에 접근하기 위한 회원가입 요구사항을 정의한다.
  - 세부내용
    - 회원가입을 위해선 다음의 정보가 기입되어야 한다
      - 사용자정보
        - 이메일 [필수]
          - 이메일은 `xxx@xxx.xxx` 형식으로 구성되어야 한다.
        - 이름 [필수]
          - 이름은 2글자 이상으로 구성되어야 한다.
        - 비밀번호 [필수]
          - 비밀번호는 **8~20자의 영문, 숫자, 특수문자 중 2종류 이상을 조합**하여 만든다.
          - 비밀번호는 **BCrypt로 암호화** 되어야 한다.
      - 사용자 프로필
        - 생년월일 [필수]
        - 성별 [필수]
        - 닉네임 [필수]
        - 휴대폰번호 [필수]
        - 키
        - 몸무게
    - 회원가입 API 요청시 다음과 같은 형식으로 보내야 한다.
    ```json
    {
      "email": "xxx@xxx.com", // 이메일
      "username": "김철수", // 이름
      "password": "abc1234!@", // 비밀번호
      "profiles": {
        "birthDate": "1995-08-10", // 생년월일
        "gender": "MAN", // 성별 (MAN, WOMAN)
        "nickname": "하늘을나는다람쥐", // 닉네임
        "mobileNo": "010-1234-1234", // 휴대폰번호
        "height": 185, // 키
        "weight": 90 // 몸무게
      }
    } 
    ```
    - 제약사항 및 참고사항
      - 회원가입 하고자 하는 회원은 본인인증 및 약관 동의가 이루어졌다고 가정한다.
---
- 요구사항 고유번호 : `SFR-02-002`
- 요구사항 명칭 : [회원] 로그인 
- 요구사항 상세설명
  - 정의 : 서비스 기능을 사용하기 위한 로그인 요구사항을 정의한다.
  - 세부내용
    - 이메일과 비밀번호를 이용하여 로그인을 진행한다.
    - 로그인 API 요청시 다음과 같은 형식으로 보내야 한다.
  ```json
      {
        "email": "xxx@xxx.com",
        "password": "abc1234!@"
      } 
  ```
---
- 요구사항 고유번호 : `SFR-03-001`
- 요구사항 명칭 : [건강측정] 건강측정 정보 관리
- 요구사항 상세설명
  - 정의 : 회원의 삼성헬스, 애플 건강의 측정 정보를 수집하여 서비스에 저장한다.
  - 세부내용
    - 회원의 삼성헬스, 애플 건강 측정 정보, 기타 그 이외의 항목들을 관리 및 저장하기 위해 검사 항목 관리 기능을 개발한다.
      - 건강 측정 정보는 들어온 요청 원본 JSON 값을 저장한다.
        - 원본 로그 ID
        - 사용자 구분 키
        - 수신일시
        - 데이터 출처
          - `HEALTH_SAMSUNG`: 삼성 헬스로 유입된 데이터
          - `HEALTH_APPLE`: 애플 건강으로 유입된 데이터
      - 건강 측정 정보는 일일 요약 테이블에 저장하여 불필요한 원본 데이터 접근을 지양한다.
        - 요약일자
        - 항목 코드
        - 합계
        - 평균
        - 최소
        - 최대
---
- 요구사항 고유번호 : `SFR-03-002`
- 요구사항 명칭 : [건강측정] 건강측정 정보 조회
- 요구사항 상세설명
  - 정의 : 회원의 삼성헬스, 애플 건강 등 데이터를 조회할 수 있다.
  - 세부내용
    - 회원은 자신의 건강측정 정보를 일별, 월별로 조회할 수 있다. 
      - 조회할 내용은 다음과 같다.
        - 일별
          - steps
          - calories
          - distance
          - recordKey
        - 월별
          - steps
          - calories
          - distance
          - recordKey
      - 제공될 데이터의 응답 형식은 다음과 같다.
```json
{
  "status":"success",
  "message":"정상적으로 수행하였습니다.",
  "data":[
      {
      "type":"daily", // "daily" or "monthly"
      "recordDate":"2024-11-01", // "YYYY-MM-DD" or "YYYY-MM"
      "steps":10000,
      "calories":700,
      "distance":2.75,
      "recordKey":""
      }
  ],
  "createdAt":"2025-12-26T03:00:00"
}
```
