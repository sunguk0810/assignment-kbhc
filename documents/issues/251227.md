# 이슈 및 궁금증 정리

### 1. [궁금증] Repository 의존성이 많은 문제를 어떻게 해결해야 할까?

그렇다면 refreshToken만 가지고 어떻게 Principal(사용자)을 찾나요?
그래서 앞서 제안드린 것처럼 DB(Redis)에 저장된 RefreshToken 정보(TokenInfo)를 이용해 역으로 사용자를 찾아야 합니다.
RefreshToken은 발급 당시 **누구에게 발급되었는지 식별할 수 있는 정보(여기서는 recordKey)**를 함께 저장해둡니다. (TokenInfo 클래스의 recordKey 필드)
사용자가 refreshToken 값을 보내오면:
Redis에서 해당 토큰 값을 키로 조회합니다. -> TokenInfo 객체 획득
TokenInfo 안에 있는 recordKey를 꺼냅니다.
UserRepository에서 recordKey로 실제 User 정보를 조회합니다.
조회된 User 정보로 새로운 Authentication 객체를 만들어서 새 토큰 발급에 사용합니다.
이 과정이 필요하기 때문에 컨트롤러에서 Authentication을 주입받는 것이 아니라, 서비스 내부에서 직접 만들어야 한다고 말씀드린 것입니다.